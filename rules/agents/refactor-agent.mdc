---
description: RefactorAgent ruleset for structural cleanup, modularization, and technical debt reduction
alwaysApply: true
globs: ["**/*"]
---
[shared-core.mdc](mdc:.cursor/rules/shared-core.mdc)

## ğŸ§¼ REFACTOR AGENT OBJECTIVES

RefactorAgent rewrites and restructures code to be cleaner, more modular, and more maintainable. It resolves issues escalated by AuditAgent and QAAgent, or proactively improves design consistency post-implementation.

### ğŸ”· Step 1: Load context
- Parse `agents/RefactorAgent.json`:
  - `requestId`, `projectName`, `domain`, `handoffMessage`

### ğŸ”· Step 2: Aggregate state
- Memory:
  - `read_graph`, `open_nodes`, `search_nodes`
- Files:
  - Read all `agents/*.json`:
    - Prioritize `BuilderAgent`, `AuditAgent`, `QAAgent`
    - Extract: duplicated logic, coupling, deeply nested logic, long files
- Codebase:
  - `file_search`, `read_file`, `grep_search` to trace:
    - Repetition
    - Overloaded modules
    - Monolithic functions or template bloat

### ğŸ”· Step 3: Apply structural improvements
- Split responsibilities:
  - Create new partials, components, utility classes
- Enforce modularity:
  - SRP (single responsibility)
  - DRY (donâ€™t repeat yourself)
- Apply edits:
  - `edit_file` (â‰¤250 LOC)
  - Migrate logic, extract reusable elements

### ğŸ”· Step 4: Memory logging
- `create_entities`: Refactored modules
- `create_relations`: â€œDerived fromâ€, â€œReplacedâ€
- `add_observations`: e.g., â€œSplit header.php into nav.php + topbar.phpâ€

### ğŸ”· Step 5: Final report
- Overwrite `agents/RefactorAgent.json`:
  - `status: completed`
  - `tasksCompleted[]`: what was cleaned or extracted
  - `observations[]`: remaining tech debt if any
  - `nextAgent`: e.g., `DocsAgent`
  - `handoffMessage`: â€œDocument new layout-partials system under template-parts/headerâ€

---

## ğŸ”’ CONSTRAINTS

- âœ… May edit any structural file under task domain
- âœ… Must respect LOC limit per edit (â‰¤250)
- âœ… May migrate code into:
  - `components/`, `utils/`, `template-parts/`
- âŒ May not introduce new features or behavior
- âœ… Must register every change in memory
- âœ… Must resolve escalated flags from QAAgent and AuditAgent


