---
description: "[TODO: Add description]"
globs:
  - "*.*"
alwaysApply: false
---

# SHARED CORE RULES

## ACTION IMPERATIVE (MANDATORY)
- AGENTS MUST EXECUTE CONTINUOUSLY.
- AGENTS MUST TRANSITION AUTOMATICALLY VIA LOGGED `nextAgent` FIELD ONLY.
- NO WAITING for user input/prompts (except Step 6 Diagnostics).
- TRANSITIONS ARE IMMEDIATE, FRAMEWORK-DRIVEN.
- IGNORE non-diagnostic user input during execution.
- ANY PAUSE violates this imperative.

## Request ID (`requestId`)
- REQUIRED unique identifier for a task sequence.
- FORMAT: String.
- USAGE:
  - Log filename: `logs/<requestId>.json`.
  - MCP Taskmanager `requestId` parameter.
  - Code Edit Tags.
- ORIGIN: Overmind or external.

## Framework
- DEFINITION: Agent execution engine.
- RESPONSIBILITIES:
  - Load agent rules based on `nextAgent`.
  - Provide tools to agents.
  - Enforce IMMEDIATE AUTOMATIC TRANSITION via `nextAgent`.
  - Manage execution lifecycle.

## Log File (`logs/<requestId>.json`)
- REQUIRED: Single source of truth (Append-Only JSON Array).
- PURPOSE:
  - State persistence.
  - History.
  - Trigger `nextAgent`.
- MANDATORY: Read at start, append valid entry (with `nextAgent`) at end.

## `nextAgent` Field
- REQUIRED control signal in latest log entry.
- FUNCTION: Directs FRAMEWORK'S immediate next agent execution.
- VALUES: Valid Agent Role name, `null`, or `"HALT"`.

## MANDATORY MCP TOOLCHAIN
- Baseline tools for most agents.

| Tool                      | Purpose                                                    |
|---------------------------|------------------------------------------------------------|
| `mcp_taskmanager_*`       | Task tracking (Overmind). `mark_task_done` is non-blocking. |
| `edit_file`               | Apply code changes/create files.                           |
| `run_terminal_cmd`        | Execute shell commands (build, test, custom tools).      |
| `context7_*`              | Fetch library/framework documentation.                     |
| `web_search`              | Access external web information.                           |
| `file_search`/`read_file` | Find/read codebase files.                                  |
| `list_dir`                | Explore directory structures.                              |
| `grep_search`             | Perform text/regex searches.                               |
| `codebase_search`         | Perform semantic searches.                                 |
| `delete_file`             | Remove files (Use with extreme caution).                     |
| `reapply`                 | Re-attempt last failed `edit_file`.                      |

## COMMON CUSTOM TOOLS (`tools/` directory)
- Run via `run_terminal_cmd python tools/<script_name.py>`.
- **`analyze_log.py`**: Parse logs.
- **`verify_environment.py`**: Check dev tools.
- **`parse_git_status.py`**: Get structured Git status.
- **`check_dependencies.py`**: Basic dependency analysis.
- **`run_linter.py`**: Execute linters.
- **`check_versions.py`**: Check critical tool versions.
- **`consolidate_code.py`**: Combine code from files.
- **`get_current_time.ps1`**: Get UTC time (PowerShell example).

## CODE EDIT TAG (MANDATORY)
- REQUIRED comment block at start of `edit_file` `code_edit` string.
- Use correct comment syntax for target language.

```
COMMENT_START Task ID: <taskId> // Optional MCP Task ID
COMMENT_START Agent Role: <agent_role>
COMMENT_START Request ID: <requestId>
COMMENT_START Project: <projectName> // From log
COMMENT_START Timestamp: <UTC timestamp> // ISO 8601 Z
COMMENT_END (if applicable)
```

## CORE AGENT BEHAVIOR RULES (MANDATORY SUMMARY)
1.  **EXECUTE ACTIONS:** Prioritize tool calls based on rules/log.
2.  **IMMEDIATE TRANSITION:** Only via logged `nextAgent`, framework-executed.
3.  **SET `nextAgent`:** MUST log correct `nextAgent` in Step 9.
4.  **DIRECT PEER TRANSITIONS:** SHOULD use direct agent handoffs when logical; return to `Overmind` for planning/escalation.
5.  **NO WAITING:** NEVER wait (except Step 6 Diagnostics). Ignore non-diagnostic user input.
6.  **LOG APPEND:** MUST append to log at turn end.
7.  **CONTINUOUS EXECUTION:** MUST execute Core Loop relentlessly.
8.  **HALT ON FAILURE:** On critical error, log failure, set `nextAgent` (Overmind/HALT), stop processing. 